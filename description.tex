\documentclass{utap}

\usepackage{wrapfig}
\usepackage{verbatim}
\usepackage{fancyvrb}
\usepackage{lscape}
\usepackage{rotating}
\usepackage{xepersian}

\graphicspath{{./img/}}

\title{تمرین شماره‌ی ۷\normalsize\qquad فاز اول}
\author{%
	\href{mailto:zangenehsaeed412@gmail.com?subject=[AP\%20S98\%20A7]\%20}{سعید زنگنه},
	\href{mailto:naghavi.pooya@gmail.com?subject=[AP\%20S98\%20A7]\%20}{پویا نقوی},
	\href{mailto:bardia.eghbali@gmail.com?subject=[AP\%20S98\%20A7]\%20}{بردیا اقبالی},
	\href{mailto:ahhabibvand@gmail.com?subject=[AP\%20S98\%20A7]\%20}{امیرحسین حبیب‌وند},
	\href{mailto:farzadhabibii98@gmail.com?subject=[AP\%20S98\%20A7]\%20}{فرزاد حبیبی}
}
\course{برنامه‌سازی پیشرفته}
\lecturer{رامتین خسروی}
\deadline{جمعه ۲۷ اردیبهشت ۱۳۹۸، ساعت ۲۳:۵۵}

\newcommand{\commandFormat}[2]
{
	\linespread{1.6}
	\begin{latin}
		\centering
		\begin{minipage}[t]{1\textwidth}
			\scriptsize
			{\VerbatimInput[frame=lines,label={\rl{دستور ورودی}}]{#1}}
			{\VerbatimInput[frame=lines,label={\rl{خروجی}}]{#2}}
		\end{minipage}
	\end{latin}
}

\newcommand{\outputOnly}[2]
{
	\linespread{1.6}
	\begin{latin}
		\centering
		\begin{minipage}[t]{1\textwidth}
			\scriptsize
			{\VerbatimInput[frame=lines,label={\rl{خروجی}}]{#1}}
		\end{minipage}
	\end{latin}
}

\begin{document}
	\maketitle
	\section*{مقدمه}
		این پروژه به جمع‌بندی آموخته‌های شما در درس می‌پردازد. انتظار می‌رود مهارت‌هایی را که در تمرین‌های پیشین و سایر بخش‌های درس آموخته‌اید در پیاده‌سازی این پروژه به کار گیرید.
		
		شما باید شبکه‌ای مجازی پیاده‌سازی کنید که در آن افراد می‌توانند به با دو نقش مختلف در آن ثبت‌نام کنند و از امکاناتی که در اختیار آن‌ها قرار داده می‌شود استفاده کنند. نقش اول ناشر است که می‌تواند در شبکه‌ی مجازی فیلم‌های خود را قرار دهد تا بقیه‌ی افراد بتوانند آن‌ها را خریداری کرده و مشاهده کنند. نقش دوم نیز مشتری‌ها هستند که می‌توانند به صورت جداگانه در شبکه ثبت‌نام کنند و به مشاهده‌ و امتیازدهی فیلم‌ها بپردازند.
		
		در فاز اول شما برنامەی این شبکه‌ی مجازی را پیادەسازی می‌کنید که با استفاده از رابط‌ کاربری خط فرمان\LTRfootnote{Command Line Interface} می‌توان از آن استفاده کرد. در فازهای بعدی این برنامه گسترش می‌یابد.


	\section{شرح تمرین}
	در این قسمت تعدادی دستور در ادامه تعریف می‌شود که شما باید آن‌ها را پیاده‌سازی کنید. تمامی دستورها پس از اجرا شدن دارای خروجی مشخصی هستند که منحصرا ذکر می‌شود. دقت کنید که خروجی‌های شما به صورت خودکار تست می‌شوند. لذا خروجی شما باید دقیقاً همانند خروجی خواسته شده باشد و در غیر این صورت نمره‌ی بخش آزمون
	\LTRfootnote{testcase}
	را از دست خواهید داد.

	\section{خطاها}
	
	در این پروژه شما تنها ملزم به بررسی سه نوع خطای زیر و خروجی دادن آن هستید که در ادامه آن‌ها را معرفی می‌کنیم.
	
	\subsection{خطای عدم وجود}
	
	اگر دستوری که کاربر وارد می‌کند (قسمت قبل از \lr{\texttt{?}} در دستورها) در لیست دستورهای تعریف شده نباشد یا کاربر با وارد کردن شناسه‌ی ناموجود سیستم قصد دسترسی به موجودیتی را داشته باشد این خطا در خروجی چاپ می‌شود.
	
		\outputOnly{commands/NotFound.out.txt}
		
	\subsection{خطای درخواست اشتباه}
	
	اگر اولین قسمت خط ورودی کاربر یکی از چهار مقدار \lr{\texttt{PUT}}, \lr{\texttt{POST}}, \lr{\texttt{GET}} یا \lr{\texttt{DELETE}} نباشد یا این دستور اطلاعات کافی برای اجرا را در خود نداشته باشد سیستم خروجی زیر را چاپ می‌کند.
	
	\outputOnly{commands/BadRequest.out.txt}
	
	\subsection{خطای عدم دسترسی}
		شرایط رخداد این دستور در ادامه‌ی متن آمده است. در صورت رخداد این خطا پیام زیر چاپ می‌شود.
		
	\outputOnly{commands/PermissionDenied.out.txt}
	
\section{دستورها}

	\subsection{ثبت‌نام}
		با این دستور افراد می‌توانند در شبکه‌ی مجازی ثبت‌نام کنند. نام کاربری هرکاربر یک رشتەی یکتا در سیستم است. 
		توجه کنید که هر کاربر دارای یک شناسه‌ی 
		\textbf{عددی یکتا}
		است که این شناسه از عدد یک شروع می‌شود. این شناسه به طور خودکار در هنگام ثبت‌نام کاربر به آن تعلق می‌گیرد. اگر نام کاربری در سیستم موجود باشد درخواست معتبر نیست و خروجی  \lr{\texttt{Bad Request}} چاپ می‌شود.
		
		وجود ویژگی ناشر‌بودن اختیاری است و در صورت ذکر‌نشدن نادرست فرض می‌شود.
		\commandFormat{commands/signup.in.txt}{commands/signup.out.txt}
	

	\subsection{ورود}
		اگر فردی قبلاً در شبکه ثبت‌نام کرده باشد، پیش از استفاده از امکانات سامانه باید در آن وارد شود. توجه کنید که کاربران بلافاصله بعد از ثبت‌نام نیازی به دستور ورود ندارند و پس از ثبت‌نام به~صورت ضمنی با همان دستور ثبت‌نام وارد سیستم نیز شده است. در صورت درست نبودن اطلاعاتی که کاربر وارد کرده است پیام \lr{\texttt{Bad Request}} در خروجی چاپ شود.
		
		\commandFormat{commands/login.in.txt}{commands/OK.out.txt}
	
	\subsection{خروج}
	اگر شخصی قبلاً در سیستم وارد شده بود با وارد کردن این دستور از سیستم خارج می‌شود و می‌تواند با یک حساب کاربری دیگر وارد سامانه شود. اگر کاربری قبل از ورود به سیستم این دستور را وارد کرد پیام \lr{\texttt{Permission Denied}} باید خروجی داده شود.
	
	\commandFormat{commands/logout.in.txt}{commands/OK.out.txt}

	\subsection{ناشران}
		دو دستور قبل برای آن بود که کاربر‌ها بتوانند به منظور استفاده از امکانات به سامانه‌ وارد شوند. هر نوع از کاربران قابلیت‌های خاص خود  را دارند که از این پس قابلیت‌های آن‌ها را در قالب دستورهایی بیان می‌کنیم.
		
		اگر کاربری به سامانه وارد نشده‌باشد یا دستوری را صدا بزند که مربوط به نوع کاربری او نیست باید پیام خطا \lr{\texttt{Permission Denied}} داده شود.

		\subsubsection{ثبت فیلم}
			هر ناشر می‌تواند با دستور زیر اطلاعات فیلم خود را وارد کرده و آن را به شبکه اضافه کند.
            کاربرد قیمت فیلم‌ها آن است که هر کاربری که بخواهد این فیلم‌ را مشاهده کند باید معادل قیمتش را پرداخت کند.
			
			توجه کنید که هر فیلم دارای یک شناسه‌ی 
			\textbf{عددی یکتا}
			 است که این شناسه از عدد یک شروع می‌شود و در صورت حذف شدن یک فیلم جایگزین نمی‌شود. این شناسه به طور خودکار در هنگام اضافه شدن فیلم به آن تعلق می‌گیرد.
			\commandFormat{commands/addFilm.in.txt}{commands/OK.out.txt}

		\subsubsection{ویرایش اطلاعات فیلم}
			هر ناشر می‌تواند اطلاعات فیلم خود را ویرایش کند. در این دستور کاربر باید شناسه‌ی فیلم را وارد کند و سپس هر بخشی از اطلاعات فیلم را که می‌خواهد تغییر بدهد جلوی آن بیاورد. در صورتی که فیلم مورد نظر به کاربر درخواست‌کننده تعلق نداشت پیام \lr{\texttt{Permission Denied}} در خروجی داده می‌شود.
			\commandFormat{commands/editFilm.in.txt}{commands/OK.out.txt}

		\subsubsection{حذف فیلم}
			هر ناشر می‌تواند فیلمی را که خودش اضافه کرده است با دستور زیر از شبکه حذف کند. در صورت عدم وجود فیلم مورد نظر در سیستم پیام \lr{\texttt{Not Found}} و در صورتی که فیلم مورد نظر به کاربر درخواست‌کننده تعلق نداشت پیام \lr{\texttt{Permission Denied}} در خروجی داده می‌شود.
			\commandFormat{commands/deleteFilm.in.txt}{commands/OK.out.txt}

\subsubsection{مشاهده لیست دنبال‌کنندگان}
هر ناشر می‌تواند لیست تمامی کسانی را که او را دنبال
\LTRfootnote{follow} 
می‌کنند با دستور زیر مشاهده کند. این نتایج باید بر حسب شناسه‌ی کاربر‌ها مرتب شده باشد.
\commandFormat{commands/publisherFollowers.in.txt}{commands/publisherFollowers.out.txt}


\subsubsection{دریافت پول از شبکه}
هر ناشر می‌تواند با دستور زیر پولی را که از فروش فیلم‌هایش بدست آورده است از شبکه دریافت کند.
هر فیلم در شبکه ممکن است یکی از سه حالت زیر را داشته باشد:
\begin{enumerate}
	\item ضعیف: اگر امتیاز یک فیلم از ۵ کمتر باشد، این فیلم در حالت ضعیف قرار دارد.
	\item متوسط: اگر امتیاز یک فیلم بیشتر مساوی ۵ باشد و کمتر از ۸ باشد، این فیلم در حالت متوسط قرار دارد.
	\item قوی: اگر امتیاز یک فیلم بیشتر مساوی ۸ باشد، این فیلم در حالت قوی قرار دارد.
\end{enumerate}
هنگامی که کاربری پولی برای یک فیلم پرداخت می‌کند، بر اساس اینکه فیلم در کدام یک از حالت‌های بالا باشد، مقداری از آن به ناشر تعلق می‌گیرد و باقی آن در حساب شبکه باقی می‌ماند. 
هر ناشر برای فیلم خود در حالت ضعیف باید۸۰ درصد، در حالت متوسط ۹۰ درصد و در حالت قوی ۹۵ درصد از مبلغ را از شبکه دریافت کند.
توجه کنید که میزان پرداخت به ناشر دقیقاً به امتیاز فیلم در لحظه‌ی خرید بستگی دارد. یعنی اگر در هنگام دریافت پول امتیاز فیلم تغییر کرده بود، میزان پول دریافتی تغییری نمی‌کند و تنها امتیاز فیلم در هنگام خرید مبنای محاسبه‌ی دریافتی‌ها است.
\commandFormat{commands/withdrawMoney.in.txt}{commands/withdrawMoney.out.txt}

		\subsubsection{مشاهده‌ی لیست فیلم‌ها}
			هر ناشر می‌تواند با دستور زیر فیلم‌هایی را که خودش در سایت قرار داده است مشاهده کند.
			\commandFormat{commands/getFilms.in.txt}{commands/getFilms.out.txt}

		\subsubsection{پاسخ دادن به نظرات}
			هر ناشر می‌تواند به نظراتی که به فیلم‌هایش داده شده پاسخ دهد. در صورت موفقیت‌آمیزبودن این دستور یک پیام به کاربر نویسنده‌ی نظر ارسال می‌شود.
			\commandFormat{commands/addReply.in.txt}{commands/OK.out.txt}

		\subsubsection{حذف کردن نظرات}
			هر ناشر می‌تواند نظراتی را که به فیلم‌هایش داده شده حذف کند.
			\commandFormat{commands/deleteComment.in.txt}{commands/OK.out.txt}
			
	\subsection{مشتریان}
		تا این جا با قابلیت‌هایی که تنها ناشر می‌تواند انجام دهد، آشنا شدیم.
		از این پس با قابلیت‌های مشتری‌ها آشنا می‌شویم.
		
        توجه کنید که هر ناشر برای فیلم‌های دیگر می‌تواند در نقش یک مشتری باشد.
		یعنی تمام قابلیت‌های مشتری را نیز علاوه بر قابلیت‌های ناشر داراست.

		\subsubsection{دنبال کردن یک ناشر}
		هر مشتری می‌تواند با دستور زیر ناشر مورد علاقه‌ی خود را دنبال کند. دنبال کردن ناشر این ویژگی را دارد که وقتی این ناشر فیلم جدیدی قرار می‌دهد به تمامی مشتری‌هایی که آن‌ را دنبال کرده‌اند، اطلاع‌رسانی می‌شود. همچنین هنگامی که یک ناشر توسط کاربری دنبال می‌شود باید برای آن ناشر پیغامی
		\LTRfootnote{notification}
 ارسال شود.
			\commandFormat{commands/customerFollow.in.txt}{commands/OK.out.txt}
		
		\subsubsection{اضافه کردن اعتبار}
		هر مشتری می‌تواند حساب خود را شارژ کند و پول خود را افزایش دهد.
			\commandFormat{commands/addMoney.in.txt}{commands/OK.out.txt}
			
		\subsubsection{جستجو}
		هر مشتری می‌تواند با دستور زیر بین تمامی فیلم‌ها جستجو انجام دهد. در این دستور ممکن است هر ویژگی از ویژگی‌های فیلم قرار گیرد که در صورت وجود باید فیلم‌ها برآن اساس فیلتر شود. در صورت وجود چند ویژگی باید نتایج نهایی شامل تمامی فیلتر‌های خواسته شده باشد. اگر هیچ ویژگی‌ای وارد نشود، خروجی باید شامل تمامی فیلم‌ها باشد.
			\commandFormat{commands/getFilms.in.txt}{commands/getFilms.out.txt}
			
		\subsubsection{مشاهده جزئیات فیلم}
		هر مشتری می‌تواند با دستور زیر جزئیات یک فیلم را مشاهده کند. همچنین در این قسمت پس از جزئیات باید نظرهایی را که برای آن فیلم گذاشته شده و پاسخ‌هایی را که آن نظرات دریافت کرده‌اند نمایش داده شود. در  انتهای این قسمت ۴ فیلم که بالاترین امتیاز را در میان فیلم‌های شبکه دارند پس از نمایش جزئیات فیلم مذکور به نمایش در می‌آید. اگر امتیاز‌ آن‌ها برابر بود ترتیب اضافه‌شدن معیار انتخاب خواهد بود و از بین گزینه‌های برابر قدیمی‌ترین‌ها انتخاب می‌شوند. توجه کنید که این فیلم‌ها نباید جزء فیلم‌هایی باشد که این کاربر قبلاً خریداری کرده است.
			\commandFormat{commands/filmDetails.in.txt}{commands/filmDetails.out.txt}
		
		\subsubsection{خرید فیلم}
		هر مشتری می‌تواند با دستور زیر پس از پرداخت هزینه‌ی یک فیلم آن را خریداری کند. این هزینه مستقیماً به دارایی شبکه‌ی مجازی اضافه خواهد شد. پس از خرید فیلم یک پیام برای ناشر فیلم ارسال می‌شود. 
			\commandFormat{commands/buyFilm.in.txt}{commands/OK.out.txt}
			
		\subsubsection{امتیازدهی به فیلم‌ها}
		هر مشتری می‌تواند پس از آن‌ که فیلمی را خرید با دستور زیر بین ۱ تا ۱۰ به آن امتیاز دهد. امتیاز هر فیلم از میانگین امتیازاتی که مشتری‌ها به آن‌ها می‌دهند، محاسبه می‌شود. پس از هر امتیاز دادن پیغامی به ناشر آن فیلم ارسال می‌شود.
			\commandFormat{commands/rateFilm.in.txt}{commands/rateFilm.out.txt}
	
		\subsubsection{نظردهی به فیلم‌ها}
		هر مشتری می‌تواند پس از آن ‌که فیلمی را خرید نظر خود را زیر آن فیلم ثبت کند. پس از هر نظر دادن پیغامی حاوی این پیام به ناشر ارسال می‌شود. 
		
		توجه کنید که هر نظر دارای یک شناسه‌ی 
		\textbf{عددی یکتا}
		 است که این شناسه برای هر فیلم به صورت جداگانه از عدد یک شروع می‌شود. این شناسه به طور خودکار در هنگام اضافه شدن نظر به آن تعلق می‌گیرد.
		\commandFormat{commands/addComment.in.txt}{commands/addComment.out.txt}	
		
		\subsubsection{مشاهده‌ی لیست فیلم‌های خریداری شده}
		هر مشتری می‌تواند لیست فیلم‌هایی را که خریداری کرده است مشاهده کند. این لیست باید بر حسب شناسه‌ی فیلم‌ها مرتب شده باشد.
		\commandFormat{commands/getPurchasedFilms.in.txt}{commands/getFilms.out.txt}	
		
		\subsubsection{مشاهده‌ی لیست پیغام‌های خوانده نشده}
		هر مشتری می‌تواند لیست پیغام‌هایی را که در زمان عدم حضور او در حساب کاربری ارسال شده است با این دستور مشاهده کند. پس از آن‌ که هر فرد پیغام‌های خوانده نشده‌ی خود را مشاهده کرد این پیغام‌ها از لیست پیغام‌های خوانده‌نشده حذف می‌شود.
		
		این لیست باید به ترتیب رسیدن پیغام‌ها مرتب شده باشد؛ یعنی جدیدترین پیغام باید در اول لیست نشان داده شود.

		\commandFormat{commands/getUnreadNotifications.in.txt}{commands/getNotifications.out.txt}	
		
		\subsubsection{مشاهده‌ی لیست همه‌ی پیغام‌ها}
		در این قسمت هر کاربر می‌تواند تمامی پیغام‌هایی را که تا به حال برای او آمده است مشاهده کند. این پیغام‌ها فقط شامل پیغام‌های خوانده شده است. همچنین در این قسمت حدی برای مشاهده‌ی پیغام‌ها وجود دارد که باید تا آن تعداد پیغام به نمایش درآید.
		
		توجه کنید که مانند بالا این لیست باید به ترتیب رسیدن پیغام‌ها مرتب شده باشد؛ یعنی جدیدترین پیغام باید در اول لیست نشان داده شود.

		\commandFormat{commands/getNotifications.in.txt}{commands/getNotifications.out.txt}	
		
		فرمت خروجی پیغام‌ها دارای انواع زیر است.
		
		\outputOnly{commands/notificationsFormat.out.txt}
		
	\section{بخش امتیازی}
		\subsection{\lr{git}}
		در این پروژه، برای کسب امتیاز بیشتر، در سایت \lr{GitHub}\LTRfootnote{\url{github.com}}
		 عضو شده و یک مخزن\LTRfootnote{repository}
		 خصوصی\LTRfootnote{private}
		 جدید ایجاد کنید. سپس پروژه را با استفاده از \lr{git} توسعه دهید. پس از اعمال هر تغییر، فایل جدید را با پیامی مناسب که نشانگر تغییرات اعمال شده در این نسخه نسبت به نسخەی قبلی است \lr{commit} و سپس \lr{push} کنید. همەی \lr{commit}ها را روی شاخه‌ی \LTRfootnote{branch}اصلی\LTRfootnote{master}
\lr{push}
	کنید. توجه کنید که هر \lr{commit} باید تنها شامل یک تغییر باشد.
		
        دقت کنید که در هنگام تحویل \lr{commit}های شما بررسی می‌شود و \textbf{تنها} در صورت استفاده‌ی بهینه و درست از \lr{git} نمرەی امتیازی آن به شما تعلق می‌گیرد. یعنی تنها ساختن یک مخزن و پوش کردن پروژه در آن نمرەای نخواهد داشت.
		
        \subsection{هش‌کردن گذرواژه}
		همان‌طور که می‌دانید گذرواژه ویژگی‌ای است که افراد تمایل دارند از دسترسی سایرین حفظ شود. به این دلیل است که هنگام ذخیره‌سازی گذرواژه آن را به صورت خام در حافظه نگهداری نمی‌کنند. هش\LTRfootnote{hash} کردن روشی که توسط آن می‌توان یک رشته را طی فرآیندی غیرقابل بازگشت به رشته‌ی دیگری تبدیل کرد؛ یعنی هش هر رشته یک رشته‌ی یکتا است و با هر رشته‌ی دیگر تفاوت دارد و همچنین از طریق هش یک رشته نمی‌توان به آن رشته دسترسی پیدا کرد.
		
		در این قسمت باید گذرواژه‌های افراد را به صورت هش‌شده در حافظه نگهداری کنیم تا از دسترسی به گذرواژه خام پرهیز شود. هش کردن الگوریتم‌های متفاوتی دارد که می‌توانید در اینترنت درباره‌ی آن‌ها جستجو کنید.

	\section{نکات پایانی}
		\begin{itemize}
			\item  در تخصیص شناسه‌ها به موجودیت‌های سیستم دقت کنید. تمام شناسه‌ها به صورت خودکار و از عدد یک شروع می‌شوند و در صورت حذف شدن یک شناسه مقدار آن جایگزین نمی‌شود؛ حتی اگر مقدار حذف شده آخرین مقدار تخصیص داده شده باشد.
		
		\end{itemize}

	\section{نحوه‌ی تحویل}
		پرونده‌‌های مربوط به برنامه‌ی خود را در پوشه‌ای با نام \lr{\path{A7-1-SID.zip}} در صفحه‌ی \lr{CECM} درس بارگذاری کنید که \lr{SID} شماره‌ی دانشجویی شماست؛ برای مثال اگر شماره‌ی دانشجویی شما ۸۱۰۱۹۷۹۹۹ باشد، نام پوشه‌ی شما باید \lr{\path{A7-1-810197999.zip}} باشد.
		\begin{itemize}
			\item
						برنامه‌ی شما باید در سیستم‌عامل لینوکس و با مترجم \lr{g++} با استاندارد \lr{\texttt{c++11}} ترجمه و اجرا شود.
					\item
						برنامه‌ی شما باید حتما طراحی شیءگرا داشته باشد. همچنین باید به صورت \lr{Multifile} باشد و استفاده از \lr{Makefile} در این تمرین اجباری است.
					\item
						هدف این تمرین یادگیری شماست. لطفاً تمرین را خودتان انجام دهید. در صورت کشف تقلب مطابق قوانین درس با آن برخورد خواهد شد.
		\end{itemize}
\end{document}
