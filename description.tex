\documentclass{utap}

\usepackage{wrapfig}
\usepackage{verbatim}
\usepackage{fancyvrb}
\usepackage{lscape}
\usepackage{rotating}
\usepackage{xepersian}

\graphicspath{{./img/}}

\title{تمرین شماره‌ی ۷\normalsize\qquad فاز اول}
\author{%
	\href{mailto:zangenehsaeed412@gmail.com?subject=[AP\%20S98\%20A7]\%20}{سعید زنگنه},
	\href{mailto:naghavi.pooya@gmail.com?subject=[AP\%20S98\%20A7]\%20}{پویا نقوی},
	\href{mailto:bardia.eghbali@gmail.com?subject=[AP\%20S98\%20A7]\%20}{بردیا اقبالی},
	\href{mailto:ahhabibvand@gmail.com?subject=[AP\%20S98\%20A7]\%20}{امیرحسین حبیب‌وند},
	\href{mailto:farzadhabibii98@gmail.com?subject=[AP\%20S98\%20A7]\%20}{فرزاد حبیبی}
}
\course{برنامه‌سازی پیشرفته}
\lecturer{رامتین خسروی}
\deadline{جمعه ۲۷ اردیبهشت ۱۳۹۸، ساعت ۲۳:۵۵}

\newcommand{\commandFormat}[2]
{
	\linespread{1.6}
	\begin{latin}
		\centering
		\begin{minipage}[t]{1\textwidth}
			\footnotesize
			{\VerbatimInput[frame=lines,label={\rl{دستور ورودی}}]{#1}}
			{\VerbatimInput[frame=lines,label={\rl{خروجی}}]{#2}}
		\end{minipage}
	\end{latin}
}

\newcommand{\outputOnly}[2]
{
	\linespread{1.6}
	\begin{latin}
		\centering
		\begin{minipage}[t]{1\textwidth}
			\footnotesize
			{\VerbatimInput[frame=lines,label={\rl{خروجی}}]{#1}}
		\end{minipage}
	\end{latin}
}

\begin{document}
	\maketitle
	\section*{مقدمه}
		در این تمرین باید تمامی آموختەهای خود در درس را به کار گیرید تا به درستی این تمرین را پیادەسازی کنید. 
		
		در این تمرین شما باید شبکه‌ای مجازی پیاده‌سازی کنید که در آن افراد می‌توانند به با دو نقش مختلف در آن ثبت‌نام کنند و از امکاناتی که در اختیار آن‌ها قرار داده می‌شود، استفاده کنند. نقش اول ناشر است که می‌تواند در شبکه‌ی مجازی فیلم‌های خود را قرار دهد تا بقیه‌ی افراد بتوانند آن‌ها را خریداری کرده و مشاهده کنند. نقش دوم نیز مشتری‌ها هستند که می‌توانند به صورت جداگانه در شبکه ثبت‌نام کنند و به مشاهده‌ و امتیازدهی فیلم‌ها بپردازند.
		
		در فاز اول شما برنامەی این شبکه‌ی مجازی را پیادەسازی می‌کنید که با استفاده از رابط‌ کاربری خط فرمان\LTRfootnote{Command Line Interface} می‌توان از آن استفاده کرد. در فازهای بعدی این برنامه گسترش می‌یابد.


	\section{شرح تمرین}
	در این قسمت تعدادی دستور در ادامه تعریف می‌شود که شما ملزم به پیاده‌سازی آن‌ها هستید. تمامی دستورات پس از اجرا شدن دارای خروجی مشخصی هستند که منحصرا ذکر می‌شود. دقت کنید که خروجی‌های شما به صورت خودکار تست می‌شوند. لذا خروجی شما باید دقیقا همانند خروجی خواسته شده باشد و در غیر این صورت نمره‌ی بخش آزمون
	\LTRfootnote{testcase}
	را از دست خواهید داد.

	\section{خطاها}
	
	در این پروژه شما تنها ملزم به بررسی سه نوع خطای زیر و خروجی دادن آن هستید که در ادامه آن‌ها را معرفی می‌کنیم.
	
	\subsection{خطای عدم وجود}
	
	اگر دستور وارد شده توسط کاربر (قسمت قبل از ؟ در دستورها) در لیست دستورات تعریف شده نباشد و یا کاربر با وارد کردن \lr{id} ناموجود سیستم قصد دسترسی به موجودیتی را داشته باشد این خطا در خروجی چاپ می‌شود.
	
		\outputOnly{commands/NotFound.out.txt}
		
	\subsection{خطای درخواست اشتباه}
	
	اگر اولین قسمت خط ورودی کاربر یکی از چهار مقدار \lr{PUT}, \lr{POST}, \lr{GET} یا \lr{DELETE} نباشد یا این دستور اطلاعات کافی برای اجرا را در خود نداشته باشد سیستم خروجی ذیل را چاپ می‌کند.
	
	\outputOnly{commands/BadRequest.out.txt}
	
	\subsection{خطای عدم دسترسی}
		شرایط رخداد این دستور در ادامه‌ی متن آمده است. در صورت رخداد این خطا پیام زیر چاپ می‌شود.
		
	\outputOnly{commands/PermissionDenied.out.txt}
	
\section{دستورها}

	\subsection{ثبت‌نام}
		توسط این دستور افراد می‌توانند در شبکه‌ی مجازی ثبت‌نام کنند. نام کاربری هرکاربر یک رشتەی یکتا در سیستم است. 
		توجه کنید که هر کاربر دارای یک شناسه‌ی 
		\textbf{عددی یکتا}
		است که این شناسه از عدد یک شروع می‌شود. این شناسه به طور خودکار در هنگام ثبت‌نام کاربر به آن تعلق می‌گیرد. اگر نام کاربری در سیستم موجود باشد درخواست معتبر نیست و خروجی  \lr{Bad Request} چاپ می‌شود.
		
		وجود ویژگی ناشر‌بودن اختیاری است و در صورت ذکر‌نشدن نادرست فرض می‌شود.
		\commandFormat{commands/signup.in.txt}{commands/signup.out.txt}
	

	\subsection{ورود}
		اگر فردی قبلا در شبکه ثبت‌نام کرده باشد، پیش از استفاده از امکانات سامانه باید در آن وارد شود. توجه کنید که اگر کاربری همان‌لحظه در سامانه ثبت‌نام کند، نیازی به دستور ورود ندارد و پس از ثبت‌نام به صورت ضمنی با همان دستور وارد نیز شده است. در صورت درست نبودن اطلاعات وارد شده توسط کاربر پیام  \lr{Bad Request} در خروجی چاپ شود.
		
		\commandFormat{commands/login.in.txt}{commands/OK.out.txt}


	\subsection{ناشران}
		دو دستور قبل برای آن بود که کاربر‌ها بتوانند به منظور استفاده از امکانات به سامانه‌ وارد شوند. هر نوع از کاربران قابلیت‌های خاص خود  را دارند که از این پس قابلیت‌های آن‌ها را در قالب دستوراتی بیان می‌کنیم.
		
		اگر کاربری به سامانه وارد نشده‌باشد یا دستوری را صدا بزند که مربوط به نوع کاربری او نیست باید پیام خطا \lr{Permission Denied} داده‌شود.

		\subsubsection{ثبت فیلم}
			هر ناشر می‌تواند توسط دستور زیر اطلاعات فیلم خود را وارد کرده و آن را به شبکه اضافه کند. قیمت فیلم‌ها به این دلیل است که هر کاربری که بخواهد این فیلم‌ را مشاهده کند باید معادل قیمت آن را پرداخت کند.
			
			توجه کنید که هر فیلم دارای یک شناسه‌ی 
			\textbf{عددی یکتا}
			 است که این شناسه از عدد یک شروع می‌شود و در صورت حذف شدن یک فیلم جایگزین نمی‌شود. این شناسه به طور خودکار در هنگام اضافه شدن فیلم به آن تعلق می‌گیرد.
			\commandFormat{commands/addFilm.in.txt}{commands/OK.out.txt}

		\subsubsection{ویرایش اطلاعات فیلم}
			هر ناشر می‌تواند اطلاعات فیلم خود را ویرایش کند. در این دستور کاربر باید شناسهٔ فیلم را وارد کند و سپس هر بخشی از اطلاعات فیلم را که می‌خواهد تغییر بدهد جلوی آن بیاورد. در صورتی که فیلم مورد نظر به کاربر درخواست‌کننده تعلق نداشت پیام \lr{Permission denied} در خروجی داده می‌شود.
			\commandFormat{commands/editFilm.in.txt}{commands/OK.out.txt}

		\subsubsection{حذف فیلم}
			هر ناشر می‌تواند فیلمی را که خودش اضافه کرده است با دستور زیر از شبکه حذف کند. در صورت عدم وجود فیلم مورد نظر در سیستم پیام \lr{Not found} و در صورتی که فیلم مورد نظر به کاربر درخواست‌کننده تعلق نداشت پیام \lr{Permission denied} در خروجی داده می‌شود.
			\commandFormat{commands/deleteFilm.in.txt}{commands/OK.out.txt}

\subsubsection{مشاهده لیست دنبال‌کنندگان}
هر ناشر می‌تواند لیست تمامی کسانی که او را دنبال
\LTRfootnote{follow} 
می‌کنند را با دستور زیر مشاهده کند. این نتایج باید بر حسب شناسه‌ی کاربر‌ها مرتب شده باشد.
\commandFormat{commands/publisherFollowers.in.txt}{commands/publisherFollowers.out.txt}


\subsubsection{دریافت پول از شبکه}
هر ناشر می‌تواند با دستور زیر پولی که از فروش فیلم‌هایش بدست آورده است را از شبکه دریافت کند.
هر فیلم در شبکه دارای ۳ حالت مختلف است:
\begin{enumerate}
	\item ضعیف: اگر امتیاز یک فیلم از ۵ کمتر باشد، این فیلم در حالت ضعیف قرار دارد.
	\item متوسط: اگر امتیاز یک فیلم بیشتر مساوی ۵ باشد و کمتر از ۸ باشد، این فیلم در حالت متوسط قرار دارد.
	\item قوی: اگر امتیاز یک فیلم بیشتر مساوی ۸ باشد، این فیلم در حالت قوی قرار دارد.
\end{enumerate}
در هنگام پرداخت پول توسط کاربر بر اساس اینکه فیلم در کدام یک از حالت‌های بالا باشد، مقداری از آن به ناشر تعلق می‌گیرد و باقی آن در حساب شبکه باقی می‌ماند. 
هر ناشر برای فیلم خود در حالت ضعیف باید۸۰ درصد، در حالت متوسط ۹۰ درصد و در حالت قوی ۹۵ درصد از مبلغ را از شبکه دریافت کند.
توجه کنید که میزان پرداخت به ناشر دقیقا به امتیاز فیلم در لحظه‌ی خرید بستگی دارد. یعنی اگر در هنگام دریافت پول امتیاز فیلم تغییر کرده بود، میزان پول دریافتی تغییری نمی‌کند و تنها امتیاز فیلم در هنگام خرید مبنای محاسبه‌ی دریافتی‌ها است.
\commandFormat{commands/withdrawMoney.in.txt}{commands/withdrawMoney.out.txt}

		\subsubsection{مشاهده‌ی لیست فیلم‌ها}
			هر ناشر می‌تواند با دستور زیر فیلم‌هایی را که خودش در سایت قرار داده است مشاهده کند.
			\commandFormat{commands/getFilms.in.txt}{commands/getFilms.out.txt}

		\subsubsection{پاسخ دادن به نظرات}
			هر ناشر می‌تواند به نظراتی که به فیلم‌هایش داده شده پاسخ دهد. در صورت موفقیت‌آمیزبودن این دستور یک پیام به کاربر نویسنده‌ی نظر ارسال می‌شود.
			\commandFormat{commands/addReply.in.txt}{commands/OK.out.txt}

		\subsubsection{حذف کردن نظرات}
			هر ناشر می‌تواند نظراتی را که به فیلم‌هایش داده شده حذف کند.
			\commandFormat{commands/deleteComment.in.txt}{commands/OK.out.txt}
			
	\subsection{مشتریان}
		تا این جا با قابلیت‌هایی که تنها ناشر می‌تواند انجام دهد، آشنا شدیم.
		از این پس با قابلیت‌های مشتری‌ها آشنا می‌شویم.
		توجه کنید که هر ناشر برای فیلم‌های دیگر می‌تواند در نقش یک مشتری باشد.
		یعنی تمام قابلیت‌های مشتری را نیز علاوه بر قابلیت‌های ناشر داراست.

		\subsubsection{دنبال کردن یک ناشر}
		هر مشتری می‌تواند توسط دستور زیر ناشر مورد علاقه‌ی خود را دنبال کند. دنبال کردن ناشر این ویژگی را دارد که وقتی این ناشر فیلم جدیدی قرار می‌دهد به تمامی مشتری‌هایی که آن‌ را دنبال کرده‌اند، اطلاع‌رسانی می‌شود. همچنین هنگامی که یک ناشر توسط کاربری دنبال می‌شود باید برای آن ناشر پیغامی
		\LTRfootnote{notification}
 ارسال شود.
			\commandFormat{commands/customerFollow.in.txt}{commands/OK.out.txt}
		
		\subsubsection{اضافه کردن اعتبار}
		هر مشتری می‌تواند حساب خود را شارژ کند و پول خود را افزایش دهد.
			\commandFormat{commands/addMoney.in.txt}{commands/OK.out.txt}
			
		\subsubsection{جستجو}
		هر مشتری می‌تواند توسط دستور زیر بین تمامی فیلم‌ها جستجو انجام دهد. در این دستور ممکن است هر ویژگی از ویژگی‌های فیلم قرار گیرد که در صورت وجود باید فیلم‌ها برآن اساس فیلتر شود. در صورت وجود چند ویژگی باید نتایج نهایی شامل تمامی فیلتر‌های خواسته شده باشد. در صورت عدم فیلتر خروجی باید شامل تمامی فیلم‌ها باشد.
			\commandFormat{commands/getFilms.in.txt}{commands/getFilms.out.txt}
			
		\subsubsection{مشاهده جزییات فیلم}
		هر مشتری می‌تواند توسط دستور زیر جزییات یک فیلم را مشاهده کند. همچنین در این قسمت پس از جزییات باید نظرهایی که برای آن فیلم گذاشته شده و پاسخ‌هایی که آن نظرات دریافت کرده‌اند را نمایش داده شود. در  انتهای این قسمت ۴ فیلم که بالاترین امتیاز را در میان فیلم‌های شبکه دارند پس از نمایش جزییات فیلم مذکور به نمایش در می‌آید. اگر امتیاز‌ آن‌ها برابر بود بر اساس ترتیب اضافه شدن باید در خروجی چاپ شوند. توجه کنید که این فیلم‌ها نباید جزو فیلم‌هایی باشد که این کاربر قبلا خریداری کرده است.
			\commandFormat{commands/filmDetails.in.txt}{commands/filmDetails.out.txt}
		
		\subsubsection{خرید فیلم}
		هر مشتری می‌تواند توسط دستور زیر پس از پرداخت هزینه‌ی یک فیلم آن را خریداری کند. این هزینه مستقیما به دارایی شبکه‌ی مجازی اضافه خواهد شد. پس از خرید فیلم یک پیام برای ناشر فیلم ارسال می‌شود. 
			\commandFormat{commands/buyFilm.in.txt}{commands/OK.out.txt}
			
		\subsubsection{دادن امتیاز به فیلم}
		هر مشتری می‌تواند پس از آن‌ که فیلمی را خرید توسط دستور زیر بین ۱ تا ۱۰ به آن امتیاز دهد. امتیاز هر فیلم از میانگین امتیازاتی که مشتری‌ها به آن‌ها می‌دهند، محاسبه می‌شود. پس از هر امتیاز دادن پیغامی به ناشر آن فیلم ارسال می‌شود.
			\commandFormat{commands/rateFilm.in.txt}{commands/rateFilm.out.txt}
	
		\subsubsection{نظر دادن به فیلم‌ها}
		هر مشتری می‌تواند پس از آن ‌که فیلمی را خرید نظر خود را زیر آن فیلم ثبت کند. پس از هر نظر دادن پیغامی حاوی این پیام به ناشر ارسال می‌شود. 
		
		توجه کنید که هر نظر دارای یک شناسه‌ی 
		\textbf{عددی یکتا}
		 است که این شناسه برای هر فیلم به صورت جداگانه از عدد یک شروع می‌شود. این شناسه به طور خودکار در هنگام اضافه شدن نظر به آن تعلق می‌گیرد.
		\commandFormat{commands/addComment.in.txt}{commands/addComment.out.txt}	
		
		\subsubsection{مشاهده‌ی لیست فیلم‌های خریداری شده}
		هر مشتری می‌تواند لیست فیلم‌هایی که خریداری کرده است را مشاهده کند. این لیست باید بر حسب شناسه‌ی فیلم‌ها مرتب شده باشد.
		\commandFormat{commands/getPurchasedFilms.in.txt}{commands/getFilms.out.txt}	
		
		\subsubsection{مشاهده‌ی لیست پیغام‌های خوانده نشده}
		هر مشتری می‌تواند لیست پیغام‌هایی که در زمان عدم حضور او در حساب کاربری ارسال شده است را توسط این دستور مشاهده کند. پس از آن‌ که هر فرد پیغام‌های خوانده نشده‌ی خود را مشاهده کرد این پیغام‌ها از آن لیست پیغام‌های خوانده نشده، حذف می‌شود.
		
		این لیست باید به ترتیب رسیدن پیغام‌ها مرتب شده باشد. یعنی جدیدترین پیغام باید در اول لیست نشان داده شود.
		\commandFormat{commands/getUnreadNotifications.in.txt}{commands/getNotifications.out.txt}	
		
		\subsubsection{مشاهده‌ی لیست همه‌ی پیغام‌ها}
		در این قسمت هر کاربر می‌تواند تمامی پیغام‌هایی که تا به حال برای او آمده است را مشاهده کند. این پیغام‌ها فقط شامل پیغام‌های خوانده شده است. همچنین در این قسمت حدی برای مشاهده‌ی پیغام‌ها وجود دارد که باید تا آن تعداد پیغام به نمایش درآید.
		
		توجه کنید که مانند بالا این لیست باید به ترتیب رسیدن پیغام‌ها مرتب شده باشد. یعنی جدیدترین پیغام باید در اول لیست نشان داده شود.
		\commandFormat{commands/getNotifications.in.txt}{commands/getNotifications.out.txt}	
		
		فرمت خروجی پیغام‌ها دارای انواع ذیل است.
		
		\outputOnly{commands/notificationsFormat.out.txt}
		
	\section{بخش امتیازی}
		\subsection{git}
		در این پروژه، برای کسب امتیاز بیشتر، در سایت github\LTRfootnote{github.com}
		 عضو شده و یک مخزن\LTRfootnote{repository}
		 خصوصی\LTRfootnote{private}
		 جدید ایجاد کنید. سپس، فایل‌هایی را که برای پروژەی خود ساختەاید روی git بگذارید. پس از اعمال هر تغییر، فایل جدید را با پیامی مناسب که نشانگر تغییرات اعمال شده در این نسخه نسبت به نسخەی قبلی است commit و سپس push کنید. همەی \lr{commit}ها را روی شاخه‌ی \LTRfootnote{branch}اصلی\LTRfootnote{master}
push
	کنید. توجه کنید که هر commit باید تنها شامل یک تغییر باشد.
		دقت کنید که در هنگام تحویل کامیت‌های شما بررسی می‌شود و تنها در صورت استفاده بهینه و درست از git نمرەی امتیازی آن به شما تعلق می‌گیرد. یعنی تنها ساختن یک مخزن و پوش کردن پروژه در آن نمرەای نخواهد داشت.
		\subsection{هش‌کردن رمزعبور}
		همان‌طور که می‌دانید رمزعبور ویژگی‌ای است که افراد تمایل دارند از دسترسی سایرین حفظ شود. به این دلیل است که هنگام ذخیره‌سازی رمز عبور آن را به صورت خام در حافظه نگهداری نمی‌کنند. هش\LTRfootnote{hash} کردن روشی که توسط آن می‌توان یک رشته را به رشته‌ی دیگری تبدیل کرد که این فرآیند غیرقابل بازگشت است. یعنی هش هر رشته یک رشته‌ی یکتا است که با هر رشته‌ی دیگر تفاوت دارد و از طریق هش یک رشته نمی‌توان به آن رشته دسترسی پیدا کرد.
		
		در این قسمت قصد داریم، رمز‌های عبور افراد را به صورت هش شده در حافظه نگهداری کنیم تا از دسترسی به رمز عبور خام پرهیز شود. هش کردن الگوریتم‌های متفاوتی دارد که می‌توانید در اینترنت درباره‌ی آن‌ها جستجو کنید.

	\section{نکات پایانی}
		\begin{itemize}
			\item  در تخصیص \lr{id} ها به موجودیت‌های سیستم دقت کنید. تمام \lr{id} ها به صورت خودکار و از عدد یک شروع می‌شوند و در صورت حذف شدن یک \lr{id} مقدار آن جایگزین نمی‌شود حتی اگر مقدار حذف شده آخرین مقدار تخصیص داده شده باشد.
		
		\end{itemize}

	\section{نحوه‌ی تحویل}
		پرونده‌‌های مربوط به برنامه‌ی خود را در پوشه‌ای با نام \lr{\path{A7-1-SID.zip}} در صفحه‌ی \lr{CECM} درس بارگذاری کنید که \lr{SID} شماره‌ی دانشجویی شماست؛ برای مثال اگر شماره‌ی دانشجویی شما ۸۱۰۱۹۷۹۹۹ باشد، نام پوشه‌ی شما باید \lr{\path{A7-Phase1-810197999.zip}} باشد.
		\begin{itemize}
			\item
						برنامه‌ی شما باید در سیستم‌عامل لینوکس و با مترجم \lr{g++} با استاندارد \lr{\texttt{c++11}} ترجمه و اجرا شود.
					\item
						برنامه‌ی شما باید حتما طراحی شیءگرا داشته باشد. همچنین باید به صورت \lr{Multifile} باشد و استفاده از \lr{Makefile} در این تمرین اجباری است.
					\item
						هدف این تمرین یادگیری شماست. لطفاً تمرین را خودتان انجام دهید. در صورت کشف تقلب مطابق قوانین درس با آن برخورد خواهد شد.
		\end{itemize}
\end{document}
